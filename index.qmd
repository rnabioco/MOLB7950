---
title: "MOLB 7950: Informatics for Molecular Biology"
format:
  html:
    theme:
      light: [cosmo, style/quarto-main.scss]
      dark: [cosmo, style/dark.scss, style/quarto-main.scss]
    mainfont: "Atkinson Hyperlegible"
    code-copy: true
    code-overflow: wrap
    toc: true
---

```{r}
#| label: render_schedule_table
#| echo: false
#| message: false
#| warning: false
#| column: screen-inset-right
library(tidyverse)
library(fs)
library(glue)
library(gt)
library(here)
library(emo)

room <- "AHSB 2201"
time <- "9:00-10:30am"

qmd_exists <- function(path) {
  path <- path_ext_set(here(path), ".qmd")
  file_exists(path)
}

sched_tbl <- read_tsv(here("data/syllabus.tsv")) |>
  mutate(
    date = ymd(date)
  ) |>
  mutate(
    class = row_number(),
    .by = c(block, topic)
  ) |>
  arrange(date) |>
  mutate(
    class = str_pad(class, 2, "left", "0"),
    week = isoweek(date),
    week = week - min(week) + 1,
    week = str_c("Week ", week)
  ) |>
  mutate(
    across(
      c(block, topic, instructor, title),
      ~ replace_na(.x, "-")
    )
  ) |>
  mutate(
    common_dir = path("content", str_to_lower(block), str_to_lower(topic)),
    page_html = path(common_dir, glue("class-{class}.html")),
    slides_html = path(common_dir, "slides", glue("class-{class}.html")),
    ex_html = path(common_dir, "exercises", glue("class-{class}.html")),
    ps_html = path(common_dir, "problem-sets", glue("class-{class}.html")),
    ps_key_html = path(common_dir, "problem-set-keys", glue("class-{class}.html")),
  ) |>
  mutate(
    # page links
    page_link = case_when(
      qmd_exists(page_html) == TRUE ~ glue('[{emo::ji("page")}]({page_html})'),
      .default = '-'
    ),
    page_link = map(page_link, gt::md),
    # slides links
    slides_link = case_when(
      qmd_exists(slides_html) == TRUE ~ glue('[{emo::ji("page")}]({slides_html})'),
      .default = '-'
    ),
    slides_link = map(slides_link, gt::md),
    # exercises links
    ex_link = case_when(
      qmd_exists(ex_html) == TRUE ~ glue('[{emo::ji("biceps")}]({ex_html})'),
      .default = '-'
    ),
    ex_link = map(ex_link, gt::md),
    # problem sets links
    ps_link = case_when(
      qmd_exists(ps_html) == TRUE ~ glue('[{emo::ji("brain")}]({ps_html})'),
      .default = '-'
    ),
    ps_link = map(ps_link, gt::md),
    # problem set keys links
    ps_key_link = case_when(
      qmd_exists(ps_key_html) == TRUE ~ glue('[{emo::ji("key")}]({ps_key_html})'),
      .default = '-'
    ),
    ps_key_link = map(ps_key_link, gt::md)
  )

gt(
  sched_tbl,
  groupname_col = "week",
  rowname_col = "class"
) |>
  tab_header(
    title = md("**MOLB 7950 - Fall 2023 Schedule**"),
    subtitle = glue("Classes held in-person in {room}, {time}")
  ) |>
  fmt_date(
    columns = date,
    date_style = "wd_m_day_year"
  ) |>
  cols_align(
    align = "center"
  ) |>
  cols_label(
    class = md("**Class**"),
    date = md("**Date**"),
    block = md("**Block**"),
    topic = md("**Topic**"),
    title = md("**Title**"),
    instructor = md("**Instructor**"),
    page_link = md("**Page**"),
    slides_link = md("**Slides**"),
    ex_link = md("**Exercises**"),
    ps_link = md("**Problem Set**"),
    ps_key_link = md("**Key**")
  ) |>
  cols_hide(
    c(ends_with("_html"), ends_with("_dir"))
    ) |>
  tab_spanner(
    label = md("**Links**"),
    columns = ends_with("_link")
  ) |>
  opt_table_font(
    font = google_font("Atkinson Hyperlegible")
  ) |>
  tab_style(
    style = list(
      cell_text(align = "center")
    ),
    locations = cells_row_groups()
  ) |>
  tab_options(
    table.width = pct(100),
    quarto.use_bootstrap = TRUE
  ) |>
  tab_style(
    style = list(
      cell_fill("grey90")
    ),
    locations = cells_row_groups()
  ) |>
  opt_row_striping()
```
