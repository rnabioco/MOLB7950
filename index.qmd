---
title: "MOLB 7950: Informatics for Molecular Biology"
format:
  html:
    theme:
      light: [cosmo, style/quarto-main.scss]
      dark: [cosmo, style/dark.scss, style/quarto-main.scss]
    mainfont: "Atkinson Hyperlegible"
    code-copy: true
    code-overflow: wrap
    toc: true
---

```{r}
#| label: render_schedule_table
#| echo: false
#| message: false
#| warning: false
library(tidyverse)
library(yaml)
library(glue)
library(gt)
library(emo)

where <- 'AHSB 2201'
when  <- '9:00-10:30am'

sched_lst <- yaml::read_yaml('schedule.yaml')

no_empty <- function(x) x[x == '' | is.null(x)] <- NA 

sched_tbl <-
  tibble(
    class      = 1:length(sched_lst),
    date       = map_chr(sched_lst, "date") |> ymd(),
    block      = map_chr(sched_lst, "block"),
    title      = map_chr(sched_lst, "title"),
    instructor = map_chr(sched_lst, "instructor"),
    ps         = map_chr(sched_lst, "ps"),
    ps_key     = map_chr(sched_lst, "ps_key") 
  ) |>
  arrange(date) |>
  mutate(
    class = str_pad(class, 2, 'left', '0'),
    title = map(title, gt::md),
    week = isoweek(date),
    week = week - min(week) + 1,
    week = str_c('Week ', week),
    # page links
    page_dir = str_c('content', block, glue('class-{class}.html'), sep = '/'),
    page_link   = glue('[{emo::ji("page")}]({page_dir})'), 
    page_link   = map(page_link, gt::md),
    # slides links
    slides_dir = str_c('content', block, glue('class-{class}.slides.html'), sep = '/'),
    slides_link   = glue('[{emo::ji("page")}]({slides_dir})'), 
    slides_link   = map(slides_link, gt::md),
  ) |>
  select(-ends_with('_dir'))

gt(
  sched_tbl,
  groupname_col = 'week',
  rowname_col = 'class'
  ) |>
  tab_header(
    title = md("**MOLB 7950 - Fall 2023 Schedule**"),
    subtitle = glue("Classes held in-person in {where}, {when}")
  ) |>
  fmt_date(
    columns = date,
    date_style = "wd_m_day_year"
  ) |>
  cols_align(
    align = 'center'
    ) |>
  cols_label(
    class = md("**Class**"),
    date = md("**Date**"),
    block = md("**Block**"),
    title = md("**Title**"),
    instructor = md("**Instructor**"),
    page_link = md("**Page**"),
    slides_link = md("**Slides**")
  ) |>
  tab_spanner(
    label = "Links",
    columns = ends_with('_link')
  ) |>
  opt_table_font(
    font = google_font('Atkinson Hyperlegible')
  ) |>
  tab_style(
    style = list(
      cell_text(align = "center")
    ),
    locations = cells_row_groups()
  ) |>
  tab_options(
    table.width = pct(100)
  )
```

