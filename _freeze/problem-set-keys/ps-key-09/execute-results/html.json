{
  "hash": "83f6125395aee201115b875cae7b2f42",
  "result": {
    "markdown": "---\ntitle: \"R Bootcamp Problem Set 9\"\nauthor: \"JH\"\ndate: last-modified \n---\n\n\n## Problem Set\n\nUse the data files in the `data/` directory to answer the questions.\n\nFor this problem set, you are allowed to help each other, but you are not\nallowed to post correct answers in slack.\n\n**The problem set is due 12pm on Sept 11.**\n\n# A quantitative PCR experiment\n\nThis problem set is a more complex version of the qPCR experiment we discussed in class.\n\nHere is the experimental setup:\n\n-   Three cell lines (`wt`, `TF-mutant`, `RL-mutant`) were treated with a drug that induces interferon expression.\n\n-   After specific time points (0, 4, 8, 12, 24 hours), cells were harvested and actin and interferon mRNA were analyzed by quantitative PCR (with 3 biological replicates, and 3 technical replicates).\n\nData for the Biological replicates come from three independent cultures and RNA samples.\n\nData for the technical replicates come the same RNA sample, measured in 3 independent qPCR reactions.\n\nThe data are in `data/`:\n\n- `data/qpcr_names_ps.tsv.gz`\n- `data/qpcr_data.tsv.gz`\n\n## Libraries\n\nLoad the libraries you need for analysis below.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n-- Attaching core tidyverse packages ------------------------ tidyverse 2.0.0 --\nv dplyr     1.1.3     v readr     2.1.4\nv forcats   1.0.0     v stringr   1.5.0\nv ggplot2   3.4.3     v tibble    3.2.1\nv lubridate 1.9.2     v tidyr     1.3.0\nv purrr     1.0.2     \n-- Conflicts ------------------------------------------ tidyverse_conflicts() --\nx dplyr::filter() masks stats::filter()\nx dplyr::lag()    masks stats::lag()\ni Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(here)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nhere() starts at /Users/jayhesselberth/devel/rnabioco/molb-7950\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(cowplot)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nAttaching package: 'cowplot'\n\nThe following object is masked from 'package:lubridate':\n\n    stamp\n```\n\n\n:::\n:::\n\n\n\n### Load the data\n\nLoad the data sets and inspect.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nqpcr_names <- read_tsv(here(\"data/qpcr_names_ps.tsv.gz\"))\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nRows: 18 Columns: 19\n-- Column specification --------------------------------------------------------\nDelimiter: \"\\t\"\nchr (19): row, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18\n\ni Use `spec()` to retrieve the full column specification for this data.\ni Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n\n\n:::\n\n```{.r .cell-code}\nqpcr_data <- read_tsv(here(\"data/qpcr_data_ps.tsv.gz\"))\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nRows: 18 Columns: 19\n-- Column specification --------------------------------------------------------\nDelimiter: \"\\t\"\nchr  (1): row\ndbl (18): 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18\n\ni Use `spec()` to retrieve the full column specification for this data.\ni Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n\n\n:::\n:::\n\n\n### Tidy the data\n\nGiven the experimental setup and the shape of the tibbles, you should be able to answer: **Are these data tidy?**\n\n-   What are the variables in the data?\n\n> genotype, time, gene, biological replicate, technical replicate \n\n-   Are the variables the column names?\n\n> Nope.\n\nThe names are encoded in the following order:\n\n`gt`, `time`, `gene`, `rep_tech`, `rep_bio`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nqpcr_names_long <-\n  pivot_longer(qpcr_names, -row, names_to = \"col\") |>\n  separate(\n    value,\n    into = c(\"gt\", \"time\", \"gene\", \"rep_tech\", \"rep_bio\"),\n    sep = \"_\",\n    convert = TRUE\n  )\nqpcr_data_long <-\n  pivot_longer(qpcr_data, -row, names_to = \"col\", values_to = \"exp\")\n\nqpcr_tidy <-\n  left_join(qpcr_names_long, qpcr_data_long) |>\n  select(-row, -col)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nJoining with `by = join_by(row, col)`\n```\n\n\n:::\n:::\n\n\n## Question 1\n\nCalculate summary statistics for the experiment.\n\n1. Calculate the mean of the technical replicates within each group of genotype, time, gene, and biological replicate.\n\n2. Calculate the mean and standard deviation of the biolgical replicates (which is the mean of technical replicates, above).\n\nYou should have a tibble that looks like this:\n\n```\n# A tibble: 36 <c3><97> 5\n   gt         time gene     bio_mean bio_sd\n   <chr>     <int> <chr>       <dbl>  <dbl>\n 1 RL-mutant     0 GAPDH       0.456  0.133\n 2 RL-mutant     0 IFN-beta    3.54   0.203\n 3 RL-mutant     4 GAPDH       1.65   0.432\n 4 RL-mutant     4 IFN-beta   17.0    2.22 \n 5 RL-mutant     8 GAPDH       2.09   1.17 \n 6 RL-mutant     8 IFN-beta   31.8    3.29 \n 7 RL-mutant    12 GAPDH       4.90   1.38 \n 8 RL-mutant    12 IFN-beta   45.8    3.61 \n 9 RL-mutant    24 GAPDH       8.50   2.49 \n10 RL-mutant    24 IFN-beta   78.1    5.80 \n# <e2><84><b9> 26 more rows\n# <e2><84><b9> Use `print(n = ...)` to see more rows\n```\n\n\n::: {.cell}\n\n```{.r .cell-code}\nqpcr_summary <-\n  qpcr_tidy |>\n  group_by(gt, time, gene, rep_bio) |>\n  summarize(\n    tech_mean = mean(exp),\n  ) |>\n  group_by(gt, time, gene) |>\n  summarize(\n    bio_mean = mean(tech_mean),\n    bio_sd = sd(tech_mean)\n  ) |>\n  ungroup()\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n`summarise()` has grouped output by 'gt', 'time', 'gene'. You can override\nusing the `.groups` argument.\n`summarise()` has grouped output by 'gt', 'time'. You can override using the\n`.groups` argument.\n```\n\n\n:::\n:::\n\n\n## Question 2\n\n1. Create a plot of expression by time from the data, using the mean of the biological replicates as the `y` value.\n\n2. Color the plot by genes.\n\n3. Use `ggplot2::geom_pointrange()` do represent the standard deviation of the data. Alternatively, use `ggplot2::geom_errobar()` with `geom_point()`.\n\n4. Draw a line through the points with `geom_line()`.\n\n4. Facet the plot by genotype.\n\n5. Change the colors of the of the plot with a `scale` function.\n\n6. Update the labels on the plot (\"time (hours)\", etc.).\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(\n  qpcr_summary,\n  aes(\n    x = time,\n    y = bio_mean,\n    color = gene\n  )\n) +\n  geom_pointrange(\n    aes(\n      ymin = bio_mean - bio_sd,\n      ymax = bio_mean + bio_sd\n    )\n  ) +\n  geom_line() +\n  facet_grid(~gt) +\n  scale_color_brewer(palette = \"Set1\") +\n  theme_cowplot()\n```\n\n::: {.cell-output-display}\n![](ps-key-09_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n### Interpret the plot\n\n- What can you say about the expression of GAPDH and IFN in the different cell types?\n\n> \n\n- Can you come up with a simple molecular mechanism to explain the results?\n\n> A straightforward explanation is that \"TF\" is a repssor of IFN induction (i.e., IFN goes up in its absence),\nand RL is similar, but possibly via an indirect effect on IFN expression. In any case, the mutants\nhave negligible impact on GAPDH expression.\n\n## Question 3\n\nReformat the data from question 2 such that you calculate a ratio of IFN to GAPDH. Start with the data question 1.2 above.\n\nRe-plot the data as in question 2, but leave out the color as you have collapsed the two genes into one value.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nqpcr_summary |>\n  select(-bio_sd) |>\n  pivot_wider(names_from = gene, values_from = bio_mean) |>\n  rowwise() |>\n  mutate(exp_ratio = `IFN-beta` / GAPDH) |>\n  ggplot(\n    aes(x = time, y = exp_ratio)\n  ) +\n  geom_point() +\n  facet_grid(~gt) +\n  ylim(0, 15) +\n  theme_cowplot()\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Removed 1 rows containing missing values (`geom_point()`).\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](ps-key-09_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\n> This is considerably less interesting than I was planning, caused by the fractional values of GAPDH. C'est la vie. Consider this an exercise in pivoting.\n\n## Question 4\n\nIs there greater variance across the technical replicates, or across the biological replicates (across the whole experiment)?\n\nTo get at this question, calculate the standard deviations across the two sets of replicates separately. Which one has a greater spread?\n\n> The key is the way you used `group_by()`. The technical replicates are tighter, which is expected if i) biology is variable and ii) you are any good at pipetting. \n\n\n::: {.cell}\n\n```{.r .cell-code}\n# one way\nqpcr_tidy |>\n  group_by(rep_tech) |>\n  summarize(tech_sd = sd(exp))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 3 x 2\n  rep_tech tech_sd\n     <int>   <dbl>\n1        1    69.6\n2        2    78.7\n3        3    74.8\n```\n\n\n:::\n\n```{.r .cell-code}\nqpcr_tidy |>\n  group_by(rep_bio) |>\n  summarize(bio_sd = sd(exp))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 3 x 2\n  rep_bio bio_sd\n    <int>  <dbl>\n1       1   73.2\n2       2   80.8\n3       3   68.9\n```\n\n\n:::\n\n```{.r .cell-code}\n# another\nqpcr_tidy |>\n  group_by(rep_tech) |>\n  summarize(tech_range = max(exp) - min(exp))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 3 x 2\n  rep_tech tech_range\n     <int>      <dbl>\n1        1       415.\n2        2       458.\n3        3       389.\n```\n\n\n:::\n\n```{.r .cell-code}\nqpcr_tidy |>\n  group_by(rep_bio) |>\n  summarize(bio_range = max(exp) - min(exp))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 3 x 2\n  rep_bio bio_range\n    <int>     <dbl>\n1       1      389.\n2       2      458.\n3       3      380.\n```\n\n\n:::\n:::\n\n\n## Grading rubric\n\n- Everything is good: full points\n- Partially correct answer: depends on how many steps are correct\n- Reasonable attempt: half points\n\n## Submit\n\nBe sure to click the \"Render\" button to render the HTML output.\n\nThen paste the URL of this Posit Cloud project into the problem set on Canvas.\n",
    "supporting": [
      "ps-key-09_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}