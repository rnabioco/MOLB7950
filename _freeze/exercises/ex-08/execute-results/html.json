{
  "hash": "000981c4f65f5d91f0bab63fd7fc104b",
  "result": {
    "markdown": "---\ntitle: \"Exercises 8\"\nauthor: \"Jay Hesselberth\"\ndate: last-modified\nformat:\n  html:\n    toc: true\n    toc-depth: 2\n    code-fold: true\n---\n\n\n# Putting it all together\n\nFor the next two classes we'll combine everything we've learned to process and visualize data from some some biological experiments. These exercises will illustrate a complete analysis pipeline -- from data tidying to manipulation and visualization -- using tools from the tidyverse.\n\n![](../img/tidy-workflow.png)\n\n### Libraries\n\nLoad the libraries you need for analysis below.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.3          ✔ readr     2.1.4     \n✔ forcats   1.0.0          ✔ stringr   1.5.0     \n✔ ggplot2   3.4.3          ✔ tibble    3.2.1     \n✔ lubridate 1.9.2          ✔ tidyr     1.3.0     \n✔ purrr     1.0.2.9000     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n:::\n\n```{.r .cell-code}\nlibrary(here)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nhere() starts at /Users/nmukherjee/Dropbox/My Mac (Neelanjan’s MacBook Pro)/Documents/GitHub/molb-7950\n```\n:::\n\n```{.r .cell-code}\nlibrary(cowplot)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'cowplot'\n\nThe following object is masked from 'package:lubridate':\n\n    stamp\n```\n:::\n:::\n\n\n# A quantitative PCR experiment\n\nHere is the experimental setup:\n\n-   Two cell lines (`wt` and `mut`) were treated with a drug that induces interferon expression\n\n-   After specific time points, cells were harvested and actin and interferon mRNA were analyzed by quantitative PCR (with 3 technical replicates), with a control containing no reverse transcriptase.\n\n### Load the data\n\nThese data are in two TSV files:\n\n-   `data/qpcr_names.tsv.gz`\n-   `data/qpcr_data.tsv.gz`\n\nLoad these data sets and inspect.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nqpcr_names <- read_tsv(here(\"data/qpcr_names.tsv.gz\"))\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nRows: 8 Columns: 13\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \"\\t\"\nchr (13): row, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n:::\n\n```{.r .cell-code}\nqpcr_data <- read_tsv(here(\"data/qpcr_data.tsv.gz\"))\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nRows: 8 Columns: 13\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \"\\t\"\nchr  (1): row\ndbl (12): 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n:::\n:::\n\n\nNote the shape of the data and the names of the rows and columns. Do they remind you of anything?\n\n![](../img/96-well-pcr-plate.png)\n\n### Tidy the data\n\nGiven the experimental setup and the shape of the tibbles, you should be able to answer: **Are these data tidy?**\n\n-   What are the variables in the data?\n-   Are the variables the column names?\n\n\n::: {.cell}\n\n```{.r .cell-code}\nqpcr_data_long <-\n  pivot_longer(qpcr_data, -row, names_to = \"col\")\n\nqpcr_names_long <- \n  pivot_longer(qpcr_names, -row, names_to = \"col\") |>\n  separate(\n    value,\n    into = c(\"gt\", \"time\", \"gene\", \"rt\", \"rep\"),\n    sep = \"_\"\n  )\n```\n:::\n\n\n### Merge the data\n\nNote the structure of the tidied data. What columns (variables) are shared by both tibbles?\n\nHow we can *join* the data from these two tibbles, linking the sample identifiers with their gene expression values?\n\n\n::: {.cell}\n\n```{.r .cell-code}\nqpcr_tidy <-\n  left_join(qpcr_names_long, qpcr_data_long) |>\n  # we don't need row & col anymore.\n  # the -RT samples are all 0, so we can drop those, too\n  filter(rt == \"+\") |>\n  select(-(row:col), -rt)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nJoining with `by = join_by(row, col)`\n```\n:::\n:::\n\n\n### Summarize the data\n\nCalculate the mean and standard deviation across replicates.\n\nDo this two ways:\n\n1.  Calculate the statistics for each gene separately.\n2.  Calculate a ratio of interferon to actin levels for each sample *before* calculating the mean and standard deviation of the ratios.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nqpcr_summary <-\n  group_by(\n    qpcr_tidy,\n    gt, time, gene) |>\n  summarize(\n    exp_mean = mean(value),\n    exp_sd = sd(value)\n  ) |>\n  arrange(gt, time, gene)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n`summarise()` has grouped output by 'gt', 'time'. You can override using the\n`.groups` argument.\n```\n:::\n:::\n\n\n### Plot the data\n\nNow we can plot the summary statistics. We'll use [`ggplot2::geom_pointrange()`](https://ggplot2.tidyverse.org/reference/geom_linerange.html) to represent the mean and standard deviation.\n\nYou'll need to fill in the blanks (`___`) below.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(\n  qpcr_summary,\n  aes(\n    x = ___,\n    y = ___,\n    color = ___\n  ),\n) +\n  geom_pointrange(\n    aes(\n      ymin = ___,\n      ymax = ___ \n    ),\n    # position = ___\n  )\n```\n:::\n\n\nInspect the above plot. How might you improve it?\n\nCopy the above chunk and add functions that modify the plot's look and feel.\n\n-   Facet the plot to see differences between the genotypes.\n-   Update the theme using `cowplot`.\n-   Update the x, y, and title labels (`ggplot2::labs()`).\n-   Update the colors with a nicer palette (`ggplot2::scale_*`).\n-   Fix the position of the geoms by updating their `position` aesthetic.\n\n\n::: {.cell}\n\n:::\n\n\n### Interpret the plot\n\n-   What can you say about the expression of ACTIN and IFN?\n-   What can you say about the mutant and wild-type cells?\n\n",
    "supporting": [
      "ex-08_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}