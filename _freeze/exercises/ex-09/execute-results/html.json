{
  "hash": "36c64d223c0b08454f2ca3025e93d4d1",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Exercises 9\"\nauthor: \"Jay Hesselberth\"\n---\n\n\n\n# A yeast gene expression experiment\n\nNext, we'll examine some gene expression data from the budding yeast *S. cerevisiae*. We'll roughly follow the analysis strategy taken by David Robinson in his blog [*Variance Explained*](http://varianceexplained.org/r/tidy-genomics-broom/).\n\nThe [data](http://growthrate.princeton.edu/transcriptome/download.shtml) come from:\n\n> Brauer MJ, Huttenhower C, Airoldi EM, Rosenstein R, Matese JC, Gresham D, Boer VM, Troyanskaya OG, Botstein D. **Coordination of growth rate, cell cycle, stress response, and metabolic activity in yeast.** *Mol Biol Cell.* 2008 [**\\[Link**\\]](https://pubmed.ncbi.nlm.nih.gov/17959824/)\n\nThey used [chemostats](https://dunham.gs.washington.edu/chemostatv2.htm) to control the growth rate of cells under different nutrient-limited conditions.\n\nIn this experiment, cells were grown in different media limited for (one of) glucose, uracil, leucine, sulfate, phosphate, or ammonia. Over a series of fixed, equilibrium growth rates (established by the dilution rate of fresh media), cells were harvested and gene expression was measured by genome-wide microarrays.\n\nThis is a well organized experiment (so it's useuful for teaching / learning), but there's nothing particularly special about the setup.\n\n-   We could be measuring protein or metabolite levels instead of gene expression, or analyzing cell features from images taken of the cells.\n\n-   We might be adding an increasing amount of a drug candidate instead of nutrient deprivation\n\n-   We might be altering the growth density of mammalian cells (by plating) instead of controlling growth rate in a chemostat.\n\n### Load libraries\n\nLoad libraries you'll need for the analysis below.\n\n\n\n::: {.cell}\n\n:::\n\n\n\n### Load the data\n\nA raw version of the gene expression data are in:\n\n-   `data/brauer_gene_exp_wide.tsv.gz`\n\nIn addition, another tibbles contains related information:\n\n-   `data/yeast_go_terms.tsv.gz`\n\nLoad each of the above files and inspect.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbrauer_gene_exp_wide <- ___ \nyeast_go_terms <- ___\n```\n:::\n\n\n\n### Tidy the data\n\n**Are these data tidy?**\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbrauer_gene_exp_tidy <-\n  pivot_longer(\n    data = ___,\n    cols = ___,\n    names_to = \"___\",\n    values_to = \"___\"\n  ) |>\n  separate(\n    ___,\n    into = c(\"___\", \"___\"),\n    sep = 1,\n    convert = TRUE\n  )\n```\n:::\n\n\n\nNext, we want to update the nutrient abbreviations so they're easier to remember.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnutrient_abbrs <- tribble(\n  ~ nutrient_abbr, ~ nutrient,\n  \"G\", \"Glucose\",\n  \"L\", \"Leucine\",\n  \"P\", \"Phosphate\",\n  \"S\", \"Sulfate\",\n  \"N\", \"Ammonia\",\n  \"U\", \"Uracil\"\n)\n\n# now, we need to *join* the tibbles\nbrauer_gene_exp_tidy <-\n  left_join(___, ___) |>\n  # drop the nutrient abbreviation \n  select(___)\n```\n:::\n\n\n\nNext, we want the common gene names, which contain useful information for filtering and grouping. These are in `yeast_go_terms`, so we need to join.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# need a tibble that maps systematic\n# common names\nname_map <- select(\n  yeast_go_terms,\n  ___, ___ \n)\n\n# we need to *join* again . . .\nbrauer_gene_exp_tidy <-\n  left_join(___, ___) |>\n  # reorganize so that systematic and common names come first\n  select(___)\n```\n:::\n\n\n\nFinally, we'll drop all rows with `NA` expression values, and arrange the tibble.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbrauer_gene_exp_tidy <-\n  # drop rows where `exp` is `NA`\n  drop_na(___, ___) |>\n  # arrange by common name, nutrient, and rate\n  arrange(___) \n```\n:::\n\n\n\n### Heatmap of gene expression values\n\nHeatmaps are a useful approach to visualize thousands of data points, orgnaized by experimental variables to show patterns in the data.\n\nWe'll use the [ComplexHeatmap](https://jokergoo.github.io/ComplexHeatmap-reference/book/) package from Bioconductor, which provides a flexible framework for generating heatmaps.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbrauer_mat_dat <-\n  brauer_gene_exp |>\n  unite(___, ___) |>\n  pivot_wider(\n    names_from = ___,\n    values_from = ___\n  )\n\nbrauer_mat <-\n  # remove name columns, just need the data\n  select(___, ___) |>\n  as.matrix()\n\n# Inspect the matrix above.\n\nComplexHeatmap::Heatmap(___)\n```\n:::\n\n\n\n### Expression of select genes associated with nutrient metabolism\n\nExamine the genes (`common_name`) that start with LEU.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nleu_genes_tbl <- brauer_gene_exp_tidy |>\n  filter(str_detect(___, \"___\"))\n\nggplot(\n  leu_genes_tbl,\n  aes(\n    x = ___,\n    y = ___,\n    color = ___ \n  )\n) +\n  geom_point() + \n  geom_smooth(method = 'lm', se = FALSE) +\n  facet_wrap(~ ___) +\n  theme_cowplot() +\n  scale_color_brewer(palette = \"Dark2\")\n```\n:::\n\n\n\n### Modeling the relationship between gene expression and growth rate\n\n#### One gene\n\nLet's look specifically at a linear model of the data for LEU1 under leucine starvation.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nleu1_tbl <- leu_genes_tbl |>\n  filter(common_name == \"___\" & nutrient == \"___\")\n\nggplot(leu1_tbl, aes(___, ___)) +\n  geom_point(size = 3) +\n  theme_cowplot()\n```\n:::\n\n\n\nLet's take a look at the linear model of these data.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmod <- lm(exp ~ rate, data = leu1_tbl)\nsummary(mod)\n```\n:::\n\n\n\nThe relevant information (rate, intercept, p.value) for the model is not easily accessed.\n\nWe can use the [broom](https://broom.tidymodels.org/) library to tidy the model information.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(broom)\nbroom::tidy(mod)\n```\n:::\n\n\n\n#### All genes\n\nDoing this for one gene is interesting, but really we'd like models for all of the conditions so that we can compare between them to identify interesting patterns.\n\nThe following code chunk will do the following:\n\n1.  nest data for model fitting into a new column `data`\n2.  fit linear models to the `data` column using `purrr::map()`\n3.  tidy the linear models using `broom::tidy()`\n4.  unnest the model coefficients\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlinear_model_tbl <-\n  brauer_gene_exp_tidy |>\n  group_by(systematic_name, common_name, nutrient) |>\n  nest() |>\n  # look at the data up to the `nest()` call\n  mutate(\n    model = purrr::map(\n      data,\n      ~ lm(exp ~ rate, data = .)\n    )\n  ) |>\n  mutate(\n    model_tidy = purrr::map(\n      model,\n      broom::tidy\n    )\n  ) |>\n  select(-model, -data) |>\n  unnest(cols = c(model_tidy))\n```\n:::\n\n\n\nNote that we now have slope and intercept terms for each group we specified.\n\n-   the `intercept` indicates how highly a gene is expressed when starved of a nutrient.\n-   the `rate` indicates how much a gene's expression responds to increasing nutrient (i.e., growth rate).\n\n### Further analysis\n\nAt this point, you can ask questions like the following:\n\n-   How do other groups of metabolic genes respond to nutrient deprivation? Start with the 'PHO', 'URA', and 'SUL' genes. Comment on features that stand out, both within and across nutrient deprivation conditions.\n\n-   What if you include and *group by* the GO terms in the `yeast_go_terms` tibble instead of gene name? I.e., you could detect the string `leucine` in the biological process and group by those instead of gene name (you'd need to *join* the tidy tibble with the GO information first).\n\n-   Are there other genes that behave like LEU1 under leucine starvation? I.e., a strong negative slope in one condition, and positive slopes in the others?\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}